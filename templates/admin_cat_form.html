{% extends "base.html" %}
{% block content %}
<div class="row justify-content-center">
  <div class="col-xl-11 col-lg-12">
    <div class="card p-4">
      <h1 class="h5 mb-3">Editar gato</h1>

      <form method="post">
        <!-- DADOS BÁSICOS -->
        <div class="form-section">
          <h6>Dados básicos</h6>
          <div class="row g-3">
            <div class="col-md-4">
              <label class="form-label">Dono</label>
              <select class="form-select" name="owner_id" required>
                {% for u in users %}
                <option value="{{ u.id }}" {% if u.id == cat.owner_id %}selected{% endif %}>{{ u.name }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="col-md-4">
              <label class="form-label">Nome do gato</label>
              <input class="form-control" name="name" value="{{ cat.name }}" required>
            </div>
            <div class="col-md-4">
              <label class="form-label">Data de nascimento</label>
              <input class="form-control" type="date" name="dob" value="{{ cat.dob }}">
            </div>

            <div class="col-md-3">
              <label class="form-label">Sexo</label>
              <select class="form-select" name="sex">
                <option value="Macho" {% if cat.sex == 'Macho' %}selected{% endif %}>Macho</option>
                <option value="Fêmea" {% if cat.sex == 'Fêmea' %}selected{% endif %}>Fêmea</option>
              </select>
            </div>

            <div class="col-md-3">
              <label class="form-label">Castrado</label>
              <select class="form-select" name="neutered">
                <option value="NÃO" {% if cat.neutered == 'NÃO' %}selected{% endif %}>NÃO</option>
                <option value="SIM" {% if cat.neutered == 'SIM' %}selected{% endif %}>SIM</option>
              </select>
            </div>

            <div class="col-md-3">
              <label class="form-label">Microchip</label>
              <input class="form-control" name="microchip" value="{{ cat.microchip }}">
            </div>

            <div class="col-md-3">
              <label class="form-label">Status</label>
              <select class="form-select" name="status">
                <option value="pending" {% if cat.status == 'pending' %}selected{% endif %}>Pendente</option>
                <option value="approved" {% if cat.status == 'approved' %}selected{% endif %}>Aprovado</option>
                <option value="rejected" {% if cat.status == 'rejected' %}selected{% endif %}>Rejeitado</option>
              </select>
            </div>
          </div>
        </div>

        <!-- RAÇA & COR -->
        <div class="form-section">
          <h6>Raça & Cor</h6>
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Raça</label>
              <select id="breed_id" class="form-select" name="breed_id"
                      onchange="loadColors('breed_id','color_id','ems_show')" required>
                {% for b in breeds %}
                <option value="{{ b.id }}" {% if b.id == cat.breed_id %}selected{% endif %}>{{ b.name }}</option>
                {% endfor %}
              </select>
            </div>

            <div class="col-md-6">
              <label class="form-label">Cor</label>
              <select id="color_id" class="form-select" name="color_id" required>
                {% for c0 in colors %}
                <option value="{{ c0.id }}" {% if c0.id == cat.color_id %}selected{% endif %}>
                  {{ c0.name }} ({{ c0.ems_code }})
                </option>
                {% endfor %}
              </select>
              <div class="form-text">EMS: <span id="ems_show"></span></div>
            </div>
          </div>
        </div>

        <!-- REGISTRO -->
        <div class="form-section">
          <h6>Registro</h6>
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Número de registro</label>
              <input class="form-control" name="registry_number" value="{{ cat.registry_number }}">
            </div>
            <div class="col-md-6">
              <label class="form-label">Entidade de registro</label>
              <select class="form-select" name="registry_entity">
                <option value="">Selecione...</option>
                <option {% if cat.registry_entity == 'FIFE Brasil' %}selected{% endif %}>FIFE Brasil</option>
                <option {% if cat.registry_entity == 'FIFE não Brasil' %}selected{% endif %}>FIFE não Brasil</option>
                <option {% if cat.registry_entity == 'não FIFE' %}selected{% endif %}>não FIFE</option>
              </select>
            </div>
          </div>
        </div>

        <!-- CRIADOR -->
        <div class="form-section">
          <h6>Criador</h6>
          <div class="row g-3">
            <div class="col-md-4">
              <label class="form-label">Criador</label>
              <select id="breeder_type" class="form-select" name="breeder_type" onchange="toggleBreederName()">
                <option value="eu mesmo" {% if cat.breeder_type == 'eu mesmo' %}selected{% endif %}>eu mesmo</option>
                <option value="outro" {% if cat.breeder_type == 'outro' %}selected{% endif %}>outro</option>
              </select>
            </div>

            <div id="breeder_name_group" class="col-md-8"
                 {% if cat.breeder_type != 'outro' %}style="display:none;"{% endif %}>
              <label class="form-label">Nome do criador</label>
              <input class="form-control" name="breeder_name" value="{{ cat.breeder_name }}">
            </div>
          </div>
        </div>

        <!-- FILIAÇÃO -->
        <div class="form-section">
          <h6>Filiação</h6>
          <div class="row g-3">
            <div class="col-md-4">
              <label class="form-label">Pai</label>
              <input class="form-control" name="sire_name" value="{{ cat.sire_name }}">
            </div>
            <div class="col-md-4">
              <label class="form-label">Raça do pai</label>
              <select id="sire_breed_id" class="form-select" name="sire_breed_id"
                      onchange="loadColors('sire_breed_id','sire_color_id','sire_ems')">
                <option value="">Selecione...</option>
                {% for b in breeds %}
                <option value="{{ b.id }}" {% if b.id == cat.sire_breed_id %}selected{% endif %}>{{ b.name }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="col-md-4">
              <label class="form-label">Cor do pai</label>
              <select id="sire_color_id" class="form-select" name="sire_color_id">
                <option value="">Selecione a raça primeiro</option>
              </select>
              <div class="form-text">EMS: <span id="sire_ems"></span></div>
            </div>

            <div class="col-md-4">
              <label class="form-label">Mãe</label>
              <input class="form-control" name="dam_name" value="{{ cat.dam_name }}">
            </div>
            <div class="col-md-4">
              <label class="form-label">Raça da mãe</label>
              <select id="dam_breed_id" class="form-select" name="dam_breed_id"
                      onchange="loadColors('dam_breed_id','dam_color_id','dam_ems')">
                <option value="">Selecione...</option>
                {% for b in breeds %}
                <option value="{{ b.id }}" {% if b.id == cat.dam_breed_id %}selected{% endif %}>{{ b.name }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="col-md-4">
              <label class="form-label">Cor da mãe</label>
              <select id="dam_color_id" class="form-select" name="dam_color_id">
                <option value="">Selecione a raça primeiro</option>
              </select>
              <div class="form-text">EMS: <span id="dam_ems"></span></div>
            </div>
          </div>
        </div>

        <!-- BOTÕES -->
        <div class="mt-3 d-flex gap-2">
          <button class="btn btn-primary" type="submit">Salvar</button>
          <a class="btn btn-outline-secondary" href="{{ url_for('admin_cats') }}">Voltar</a>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}
